<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

		<script src = 'sounds.js?111'></script>
		<title>Below Hayden</title>
		<link rel = 'stylesheet' href = 'style.css?111'>
		<link href="https://cdn.jsdelivr.net/npm/@fontsource/unifont@5.2.5/index.min.css" rel="stylesheet">

	</head>
	<body>

		<h1 class = 'game-title'>Below Hayden</h1>

		<div id = 'main-ui'>
			<marquee>High Score: <span id = 'high-score'></span></marquee>
			<div>
				<div id = 'hpbar' class = 'bar'>
					<strong>HP: <span id="playerHP"></span></strong> 
					<div></div>
				</div>
				<div id = 'xpbar' class = 'bar'>
					<strong>XP: <span id="playerXP"></span></strong> 
					<div></div>
				</div>
				<strong id = 'level-label'>Level:</strong> <span id="floor">1</span>
				<strong>Gold:</strong> <span id="gold">1</span>
			</div>
		</div>

		<div id = 'game-frame'>

			<div id = 'doors'>
				<button onclick="pickDoor(this)" class = 'door'>Door 1</button>
				<button onclick="pickDoor(this)" class = 'door'>Door 2</button>
				<button onclick="pickDoor(this)" class = 'door'>Door 3</button>
				<button onclick="pickDoor(this)" class = 'door'>Door 4</button>
			</div>

			<br/>

			<div class = 'monsters'>
			</div>

			<button class = 'chest closed' onclick = 'useChest()'></button>
			

			<div id="last-log">YOU KICK DOWN THE DOOR. THERE IS A BAT HERE.</div>
			
			<div id = 'inventory'>
				<button class = 'item' data-id = '-1' onclick = "showItemInfo(this)"></button>
				<button class = 'item' data-id = '-1' onclick = "showItemInfo(this)"></button>
				<button class = 'item' data-id = '-1' onclick = "showItemInfo(this)"></button>
				<button class = 'item' data-id = '-1' onclick = "showItemInfo(this)"></button>
			</div>

			<p id = 'item-info'></p>
		</div>

		<div id="death-text">
			<h2>You died at Level <span id = 'died-at-level'></span>!</h2>
			<p><span id = 'dead-high-score'></span></p>
			<a href="?">Play Again?</a>
		</div>

		<br/>
		<details collapsed>
			<h3>Enemy</h3>
			<div id="enemyInfo"></div>

			<h3>Log</h3>
			<div id="log"></div>
		</details>

		<script>

			if(typeof localStorage.highScore == "undefined") { localStorage.highScore = 10; }
			document.querySelector("#high-score").innerText = Number.parseInt(localStorage.highScore);

			window.id = 0;

			let basicAttack = new Item("Basic Attack",-1,-1, sou_punch[0], 0, 1, 0);

			let player = { 
				hp: 20, 
				maxHp: 20, 
				gold: 0, 
				dmg: 1,
				level: 1,
				inventory: [], 
				xp:0,

				getXPToNextLevel: fn=>{ return xpToNextLevel =  100 * (player.level ^ 1.5); },
				handleLeveling: function() {


					let xpToNextLevel = player.getXPToNextLevel();

					//XPToLevel(n) = XPBase * (n ^ LevelCurve)

					//document.querySelector("#xpbar div").style.width = ((player.xp / xpToNextLevel) * 100) + "%"

					if(player.xp > xpToNextLevel) {

						player.level++;
						player.maxHp += 10;
						player.dmg++;
						player.hp = player.getMaxHp();
						player.xp = 0;

					}
				},
				getDmg: function(){ let d = this.dmg + (player.level / 4); this.inventory.forEach(item=>{ if(!item.consumable) { d+=item.dmg; } }); return d; },
				getMaxHp: function(){ let d = this.maxHp; this.inventory.forEach(item=>{ if(!item.consumable) { d+=item.hp; } }); return d; },
				attack: function(targets, item=false) {
					
					if(!Array.isArray(targets)) { targets = [targets]; }

					//Run through each of our targets and deal damage/play sound/animation
					targets.forEach((monster,ind)=>{

						if(typeof monster == "number") { monster = monsters.filter(m=>{return m.id == monster; })[0]; }

						setTimeout(fn=>{

							let crit = false;
							let playerDmg = item ? item.dmg : Math.floor(player.getDmg() + (Math.random() * 6));
							let logText = "";

							if(Math.round(Math.random() * 20) > 18) {
								logText += "<span class = 'critText'>CRITICAL HIT!</span>&nbsp;";
								playerDmg *= 2;
								crit = true;

								sou_crit.play();
							}

							if(item) {
								item.sound.play();
							}
							else {
								sou_punch[Math.floor(Math.random() * sou_punch.length)].play();
							}

							monster.takeDamage(playerDmg, false);
							
							setTimeout(fn=>{
								let d = document.querySelector(`[data-monster-id="${monster.id}"]`);
								if(d != null) {
									document.querySelector(`[data-monster-id="${monster.id}"]`).style.animation = "shake .5s ease 0s 1 normal forwards";
								}
							},1, monster);

							log(`${logText} Hit ${monster.name} for ${playerDmg}.`);

							if(crit) { bindCritAnimation(); }

							updateUI();
							lockMonsters();

						}, 500 * ind);
					});


					//After we've hit all our targets, check if anyone/everyone is dead and remove them.
					setTimeout(fn=>{

						updateUI();

						let delay = 0;

						monsters.forEach((monster,ind)=>{

							if(monster.hp <= 0) {


								setTimeout(fnz=>{

										
									defeatEnemy(monster);

								},delay);
								delay += 350;
							}

						});

						setTimeout(fn=>{
							monsterTurn();
						}, delay);

						//unlockMonsters();

					}, (monsters.length * 500) + 500);

				}
			};


			giveItem(new Item("Healing Potion", "Heal yourself", "dungeon/wee_dung_potion_red.png", sou_potion, 10,0,true,1));
			giveItem(new Item("Pyro Scroll of +3", "Cast fire spell on all enemies", "dungeon/wee_dung_scroll.png", sou_fire, 0, 3,true,3));


			let floor = 1
			let enemy = null
			let monsters = [];
			let thisRoomDifficulty = 0;

			const playerHPSpan = document.getElementById('playerHP')
			const playerXPSpan = document.getElementById('playerXP')
			const floorSpan = document.getElementById('floor')
			const goldSpan = document.getElementById('gold')
			const logDiv = document.getElementById('log')
			const enemyDiv = document.getElementById('enemyInfo')
			const enemyHearts = document.querySelector("#hearts");
			const monsterButton = document.querySelector(".monster");
			const chestButton = document.querySelector(".chest");
			const lastLog = document.querySelector("#last-log");
			const monsterDOM = document.querySelector(".monsters");
			const itemInfo = document.querySelector("#item-info");

			function log(msg) {

				logDiv.innerText += msg + "\n"
				logDiv.scrollTop = logDiv.scrollHeight

				lastLog.innerHTML = msg;
			}

			function updateUI() {

				itemInfo.classList.remove("open");

				playerHPSpan.textContent = `${player.hp}/${player.getMaxHp()}`
				playerXPSpan.textContent = `${player.xp}/${player.getXPToNextLevel()}`

				floorSpan.textContent = player.level
				goldSpan.textContent = player.gold;

				if(player.level > localStorage.highScore) {
					localStorage.highScore = player.level;
					document.querySelector("#high-score").innerText = floor;
				}

				document.querySelector("#hpbar div").style.width = 100*(player.hp/player.getMaxHp()) + "%";
				document.querySelector("#xpbar div").style.width = 100*(player.xp/player.getXPToNextLevel()) + "%";

				monsterDOM.innerHTML = "";

				if(monsters.length > 0) {
					monsters.forEach(monster=>{

						let monsterHearts = monster.formatHearts();
						

						let monsterTemplate = `
							<div data-monster-container = "${monster.id}" class = 'monster-container' style = 'width: ${ 80 / monsters.length }%'>
								<div class = 'hearts' style = "visibility:visible;">${monsterHearts}</div>
								<button 
									data-monster-id="${monster.id}" 
									class = 'monster' 
									onclick="player.attack(${monster.id})"
									style = "background-image: url(monsters/${monster.sprite});display:inline-block;"
								>${monster.name}</button>
							</div>
						`;

						monsterDOM.innerHTML += monsterTemplate;
					});
				}
				
			}


			function Monster(name, sprite, hp=5, dmg=1) {

				this.id = window.id;
				window.id++;
				this.name = name;
				this.sprite = sprite;
				this.maxHp = (hp +  Math.floor(floor / 3)) * (thisRoomDifficulty+1);
				this.hp = this.maxHp;
				this.dmg = dmg;
				this.attack = fn=>{ 

					
					sou_punch[Math.floor(Math.random() * sou_punch.length)].play();

					let dmg = this.dmg + (Math.floor(floor / 3)) + Math.floor(Math.random() * 6);
					player.hp -= dmg;


					log(`The ${this.name} hits you for ${dmg} damage.`)

					updateUI();
					lockMonsters();

					document.querySelector(`[data-monster-id="${ this.id }"]`).style.animation = "enemyAttack .5s ease 0s 1 normal forwards";
					setTimeout(fn=>{document.querySelector(`[data-monster-id="${ this.id }"]`).style.animation = "combatIdle 2s ease 0s infinite normal forwards";}, 512);

					checkIsDefeated();
				};

				this.takeDamage = (dmg, autocull) => { 
					this.hp -= dmg; 
					if(this.hp <= 0 && autocull) { defeatEnemy(this); } 
				}

				this.formatHearts = function() {

					let monsterHearts = "";

					if(this.hp < 10) {
						for(let v = 0; v < this.hp; v++) { monsterHearts += "<span class = 'heart'></span>" } 
					}
					else { monsterHearts = "<span class = 'heart'>&nbsp;x"+this.hp+"</span>"; }

					return monsterHearts;
				}

				return this;
			}

			function monsterTurn() {

				updateUI();
				lockMonsters();

				monsters.forEach((monster,ind)=>{

					setTimeout(fn=>{

						monster.attack();

					}, 500 * ind);

				});

				setTimeout(fn=>{

					if(!checkIsDefeated() && monsters.length > 0) {

						
						updateUI();

						log("YOUR TURN.");

						unlockMonsters();
					}
				}, (500 * monsters.length));
			}

			
			function Item(name, desc, sprite="wee_dung_potion_red.png", sound=sou_potion, hp=0, dmg=0, consumable=true, uses=1, slot=-1, use = -1) {

				this.id = window.id;
				window.id++;
				this.name = name;
				this.desc = desc;
				this.sprite = sprite;
				this.hp = hp;
				this.dmg = dmg;
				this.consumable = consumable;
				this.sound = sound;
				this.uses=uses;
				this.slot = slot;

				if(typeof use == "function") { this.use = use; }
				else {

					this.use = (override=false)=>{
						
						if(this.consumable || override) {
							

							log(`Used ${this.name}...`);
							console.log(this);

							if(monsters.length > 0 && this.dmg > 0) {

								lockMonsters();

								player.attack(monsters, this);
								
							}
							else {

								this.sound.play();

								if(this.hp > 0) {
									player.hp += this.hp;
									log(`...healed for ${this.hp}. `);
								}
								if(this.hp < 0) {
									player.hp += this.hp;
									log(`...hurt yourself for ${this.hp}. `);
								}

								if(player.hp >= player.maxHp) { player.hp = player.maxHp; }

								updateUI();
							}

							this.uses--;

							if(this.uses <= 0) {
								removeItem(this.id);
							}
						}

					}
					
				}

				return this;
			}

			function removeItem(id) {

				if(typeof id != "number") {id = id.dataset.id; }
				
				let itemEl = document.querySelector(`[data-id="${id}"]`);
				itemEl.dataset.id = -1;
				itemEl.style.backgroundImage = "";
				player.inventory = player.inventory.filter(i=>{return i.id != id}); 

				return false;
			}

			function useItem(el){

				let id = typeof el == "number" ? el : el.dataset.id;

				if(id != -1) {
					let item = player.inventory.filter(item=>{return item.id == id;})[0];
					console.log(item);
					item.use();
				}
			}

			function showItemInfo(el) {

				if(el.dataset.id != -1) {

					sou_menu_open.play();

					if(itemInfo.classList.contains("open") && itemInfo.dataset.item == el.dataset.id) { itemInfo.classList.remove("open"); }
					else { itemInfo.classList.add("open"); }


					itemInfo.dataset.item = el.dataset.id;

					let item = player.inventory.filter(item=>{return item.id == el.dataset.id; })[0];

					itemInfo.innerHTML = `
						${item.name}<br/>
						${(item.consumable ? (item.uses + " uses left.") : "")}<br/>
						<div>${item.desc}</div>

						<button onclick = "useItem(this);updateUI();" data-id="${el.dataset.id}">USE</button> 
						<button onclick = "removeItem(this);sou_item_drop.play();updateUI();" data-id="${el.dataset.id}">DROP</button>
					`;
				}
				else {
					itemInfo.classList.remove("open"); 
				}
			}

			function clearItemInfo() {
				itemInfo.innerHTML = "";
			}
			
			const monsterList = [
				[
					["Slime", "wee_mons_slime_idle_d_1.png"], 
					["Bat", "wee_mons_bat_atk_l_1.png"], 
					["Ghost", "wee_mons_ghost_atk_d_1.png"]
				],
				[
					["Goblin", "wee_mons_gobwar_idle_d_2.png",6,3], 
					["Skeleton", "wee_mons_skelshield_atk_u_2.png",6,2],
					["Evil Eye", "wee_mons_eye_idle_d_2.png",8,1], 
					["Zombie", "wee_mons_zombie_atk_d_1.png",5,3]
				],
				[
					["Red Mage", "wee_mons_mage_atk_d_2.png", 15, 6],
					["Necromancer", "wee_mons_necro_idle_d_2.png", 15, 8]
				],
				[
					["Reaper", "wee_mons_reaper_atk_d_1.png", 25, 30]
				],
			];

			function generateEnemy(difficultyLevel=0) {
				
				


				const enemy = new Monster(...monsterList[floor-1][Math.floor(Math.random() *  monsterList[floor-1].length)]);
				enemy.level = thisRoomDifficulty;

				log(`A wild ${enemy.name} appears!`)

				return enemy;
			}

			function defeatEnemy(enemy) {

					
				sou_kill_foe.play();
				log(`You defeated the ${enemy.name}!`);



				monsters = monsters.filter(monster=>{ return monster.id != enemy.id; });
				

				//floor += 1 + thisRoomDifficulty;

				//XP = BaseXP * (EnemyLevel ^ EnemyPowerCurve)
				
				player.xp += 10 * (enemy.maxHp ^ 1.3) * (thisRoomDifficulty+1);
				player.handleLeveling();
				

				if(monsters.length == 0) {

					chestButton.classList.add("closed");
					chestButton.style.visibility = "visible";
					

					setTimeout(fn=>{
						chestButton.style.opacity = 1;
					},1);
					
					enableDoors();

					sou_chest_fadeIn.play();
				}

				updateUI();
			}

			function lockMonsters() {
				document.querySelectorAll(".monsters button").forEach(monster=>{monster.disabled = true;})
			}

			function unlockMonsters() {
				document.querySelectorAll(".monsters button").forEach(monster=>{monster.disabled = false;})
			}


			function attack(enemy, doAttack=true, extraLog="") {

				if(typeof enemy == "number") {
					enemy = monsters.filter(monster=>{ return monster.id == enemy; })[0];
				}

				let logText = extraLog;

				if(!enemy) {
					logText += ("There is nothing to attack.")
					return
				}

				let crit = false;
				if(doAttack) {

					let playerDmg = Math.floor(player.getDmg() + (Math.random() * 6));

					if(Math.round(Math.random() * 20) > 18) {
						logText += "<span class = 'critText'>CRITICAL HIT!</span>&nbsp;";
						playerDmg *= 2;
						crit = true;

						sou_crit.play();
					}

					enemy.hp -= playerDmg;

					logText += (`You hit the ${enemy.name} for ${playerDmg} damage.`);

					sou_punch[Math.floor(Math.random() * sou_punch.length)].play();

					setTimeout(fn=>{
						let d = document.querySelector(`[data-monster-id="${enemy.id}"]`);
						if(d != null) {
							document.querySelector(`[data-monster-id="${enemy.id}"]`).style.animation = "shake .5s ease 0s 1 normal forwards";
						}
					},1,enemy);
				}

				log(logText);
				if(crit) { bindCritAnimation(); }


				if(enemy.hp <= 0) {
					
					updateUI();
					lockMonsters();

					setTimeout(fn=>{
						defeatEnemy(enemy);
						updateUI();
					}, 1000);
				} 
				else {

					updateUI();
					lockMonsters();

					setTimeout(fn=>{

						let logText = "";

						if(doAttack) {
							sou_punch[Math.floor(Math.random() * sou_punch.length)].play();

							const enemyDmg = enemy.attack()
							player.hp -= enemyDmg;

							logText += (`The ${enemy.name} hits you for ${enemyDmg} damage.`)

							log(logText);

							updateUI();
							lockMonsters();
							
							checkIsDefeated();
						}

						setTimeout(fn=>{

							log("Your turn.");
							
							unlockMonsters();

						}, 750);

					}, 750 + (crit ? 500 : 0));
				}

				
			}

			function checkIsDefeated() { 

				if (player.hp <= 0) {
					log("You died! Game over.")

					
					document.querySelector("#death-text").classList.add("dead");
					document.querySelector("#game-frame").classList.add("dead");

					document.querySelector("#died-at-level").innerHTML = player.level;
					document.querySelector("#dead-high-score").innerHTML = player.level >= localStorage.highScore ? "A NEW HIGH SCORE!" : ("High Score:"+localStorage.highScore);
					
					return true;
				}
				return false;
			}

			currentChestContents = null

			function useChest() {

				if(chestButton.classList.contains("closed")) {
					log("You open the chest...");
					sou_door.play();
					return chestButton.classList.remove("closed");
				}

				if(!chestButton.classList.contains("empty") && currentChestContents == null) {
				
					let dice = Math.floor(Math.random() * 20);// + 1 + thisRoomDifficulty*2;

					//Give gold
					if(dice < 7) {
						sou_foundSomethingSm.play();
						let gold = thisRoomDifficulty * Math.round(Math.random() * 20) + 5;

						log(`FOUND ${gold} GOLD`);
						player.gold += gold;
						chestButton.classList.add("empty");
					}

					//Give item
					else if(dice >= 7 && dice < 12) {
						sou_foundSomethingMd.play();

						let items = [
							new Item("Healing Potion", "Heal yourself", "dungeon/wee_dung_potion_red.png", sou_potion, 10,0,true,1),
							new Item("Pyro Scroll", "Cast fire spell on all enemies", "dungeon/wee_dung_scroll.png", sou_fire, 0, 1 + Math.floor(floor/3), true, 1 + Math.floor(Math.random() * 3)),
						];

						let item = items[Math.floor(Math.random() * items.length)];

						item.name += " of +" + (item.dmg||item.hp);

						if(player.inventory.length < 4) {
							giveItem(item);
							log("FOUND " + item.name);
							chestButton.classList.add("empty");
							currentChestContents = null;
						}
						else {
							currentChestContents = item;
							log("FOUND " + item.name + ". Inventory full!");
						}

					}
					
					//Give gear
					else {
						sou_foundSomethingLg.play();

						let items = [
							new Item("Sword", "Deal extra damage", "dungeon/wee_dung_sword.png", sou_potion, 0, (floor / 5) + Math.floor(Math.random() * 4) + thisRoomDifficulty, false, 1, "weapon"),
							new Item("Axe", "A blade which does cleaving damage.", "dungeon/axe.png", sou_potion, 0, (floor / 4) + Math.floor(Math.random() * 4) + thisRoomDifficulty,false,1, "weapon"),
							new Item("Cursed Blade", "A sword carrying a curse.", "dungeon/wee_dung_sword.png", sou_potion, 0, -((floor / 4) + Math.floor(Math.random() * 4) + thisRoomDifficulty),false,1, "weapon"),
							new Item("Helm", "Increase max HP", "dungeon/wee_dung_helm.png", sou_potion, 4 + (floor / 4) + Math.floor(Math.random() * 4)  + thisRoomDifficulty, 0,false,1, "helm"),
						];

						let item = items[Math.floor(Math.random() * items.length)];

						item.name += " of +" + (item.dmg || item.hp);
						
						let slotIsEmpty = (item.slot == -1 || player.inventory.filter(i=>{ return i.slot == item.slot;}).length == 0);
						
						if(player.inventory.length < 4 && slotIsEmpty) {
							
							giveItem(item);
							log("FOUND " + item.name);
							chestButton.classList.add("empty");
							currentChestContents = null;

						}
						else if(!slotIsEmpty) {
							
							currentChestContents = item;
							log("FOUND " + item.name + ". Can only have one " + item.slot + " at a time!");
						}
						else {
							currentChestContents = item;
							log("FOUND " + item.name + ". Inventory full!");
						}
					}


					updateUI();
				}

				else if(currentChestContents != null) {
					
					let slotIsEmpty = (currentChestContents.slot == -1 || player.inventory.filter(i=>{ return i.slot == currentChestContents.slot;}).length == 0);
					
					if(!slotIsEmpty) {
							
						currentChestContents = item;
						log("FOUND " + item.name + ". Can only have one " + item.slot + " at a time!");
					}
					else if(player.inventory.length < 4) {
						giveItem(currentChestContents);
						chestButton.classList.add("empty");
						log("FOUND " + item.name);
						currentChestContents = null;
					}
					else {
						log("FOUND " + currentChestContents.name + ". Inventory full!");
					}
				}
			}

			function giveItem(item) {

				currentChestContents = null;
				
				player.inventory.push(item);
				let found = false;

				document.querySelectorAll(".item").forEach(el=>{
					if(el.dataset.id == '-1' && !found) {
						el.style.backgroundImage = `url("${item.sprite}")`;
						el.dataset.id = item.id;
						found = true;
					}
				});
			}

			function pickDoor(el) {
				

				disableDoors();
				el.classList.add("open");
				sou_door.play();

				if(el.classList.contains("stairs")) { floor += 1; }

				setTimeout(fn=>{
					el.classList.add("chosen");
					sou_stairs.play();
					document.body.style.opacity = 0;

					setTimeout(()=>{
						el.classList.remove("chosen");
						el.classList.remove("open");


						setTimeout(()=>{
							document.body.style.opacity=1;
							document.querySelector("#doors").innerHTML = "";
							enterPath(el.dataset.level);
						},200,el);

					},500,el);

				}, 500);
			}

			function enterPath(difficultyLevel) {

				console.log(difficultyLevel);

				difficultyLevel = Math.min(monsterList.length - 1, (Number.parseInt(difficultyLevel)||0) );
				thisRoomDifficulty = difficultyLevel;
				randomizeDoors();
				disableDoors();
				
				chestButton.style.visibility = "hidden";
				chestButton.style.opacity = 0;
				chestButton.classList.remove("empty");
				currentChestContents = null;
			
				if (player.hp <= 0) return

				
				player.hp = Math.min(player.hp + 5, player.getMaxHp())

				for(let v = 0; v < 1 + Math.floor(Math.random() * (2 + floor + difficultyLevel)); v++) {
					
					enemy = generateEnemy(difficultyLevel);
					monsters.push(enemy);
				}

				log(`You enter the room. There's a ${monsters.map(m=>{ return m.name }).join(", and a ") } here!`)
				updateUI()
			}

			function randomizeDoors() {


				for(let v = 0; v < 1 + Math.round(Math.random() * 3); v++) {
					

					let dice = Math.random() * 20;

					let dlvl = dice < 16 + (floor / 5) ? 0 : Math.floor(20-dice);

					document.querySelector("#doors").innerHTML += `
						<button onclick="pickDoor(this)" style = 'background-image:url(dungeon/door${dlvl}.png);' class = 'door' data-level="${
							dlvl
						}">Door ${v}</button>
					`;
				}


				document.querySelectorAll(".door").forEach(door=>{ 

					let dice = Math.floor(Math.random() * 20) + 1;

					if(dice == 6) { door.style.backgroundImage = `url("dungeon/wee_dung_stair_blue_down.png")`; door.classList.add("stairs"); }
				});
			}
			function disableDoors() {
				document.querySelectorAll(".door").forEach(door=>{ 
					door.disabled = true; 
				});
			}
			function enableDoors() {
				document.querySelector("#doors").style.visibility = "visible";
				document.querySelectorAll(".door").forEach(door=>{ 
					door.disabled = false; 
				});
			}

			function restart() {
				player.hp = 20
				floor = 1
				logDiv.innerText = ''
				
				log("You awaken in a dungeon.<br/>Choose a door to explore.")

				updateUI()
			}


			// Start game
			restart();


			//https://codepen.io/zachkrall/pen/MWWGMPx
			function bindCritAnimation(){

				let h1 = document.querySelector(".critText");

				h1.innerHTML = h1.innerHTML
					.split("")
					.map(letter => {
					console.log(letter);
					return `<span>` + letter + `</span>`;
					})
					.join("");

				Array.from(h1.children).forEach((span, index) => {
					setTimeout(() => {
						span.classList.add("wavy");
					}, index * 60);
				});

			}
		</script>
	</body>
</html>
